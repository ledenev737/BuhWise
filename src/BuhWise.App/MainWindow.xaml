<Window x:Class="BuhWise.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:sys="clr-namespace:System;assembly=mscorlib"
        Title="BuhWise" Height="600" Width="900" Background="#1E1E1E" Foreground="White">
    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- Balance cards -->
        <UniformGrid Columns="3" Margin="0 0 0 16">
            <Border Background="#2D2D30" Padding="12" CornerRadius="6" Margin="4">
                <StackPanel>
                    <TextBlock Text="USD" FontSize="16" FontWeight="Bold" />
                    <TextBlock x:Name="UsdBalance" FontSize="20" />
                </StackPanel>
            </Border>
            <Border Background="#2D2D30" Padding="12" CornerRadius="6" Margin="4">
                <StackPanel>
                    <TextBlock Text="EUR" FontSize="16" FontWeight="Bold" />
                    <TextBlock x:Name="EurBalance" FontSize="20" />
                </StackPanel>
            </Border>
            <Border Background="#2D2D30" Padding="12" CornerRadius="6" Margin="4">
                <StackPanel>
                    <TextBlock Text="RUB" FontSize="16" FontWeight="Bold" />
                    <TextBlock x:Name="RubBalance" FontSize="20" />
                </StackPanel>
            </Border>
        </UniformGrid>

        <!-- Operation entry form -->
        <Border Grid.Row="1" Background="#2D2D30" Padding="12" CornerRadius="6" Margin="0 0 0 16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <StackPanel Orientation="Vertical" Margin="4" Grid.Column="0" Grid.Row="0">
                    <TextBlock Text="Тип операции" Margin="0 0 0 4" />
                    <ComboBox x:Name="OperationTypeBox" SelectedIndex="0" Height="28" SelectionChanged="OperationTypeBox_SelectionChanged">
                        <ComboBoxItem Content="Пополнение" Tag="Income" />
                        <ComboBoxItem Content="Расход" Tag="Expense" />
                        <ComboBoxItem Content="Обмен" Tag="Exchange" />
                    </ComboBox>
                </StackPanel>

                <StackPanel Orientation="Vertical" Margin="4" Grid.Column="1" Grid.Row="0">
                    <TextBlock Text="Исходная валюта" Margin="0 0 0 4" />
                    <ComboBox x:Name="SourceCurrencyBox" SelectedIndex="0" Height="28" SelectionChanged="CurrencyBox_SelectionChanged">
                        <ComboBoxItem Content="USD" Tag="USD" />
                        <ComboBoxItem Content="EUR" Tag="EUR" />
                        <ComboBoxItem Content="RUB" Tag="RUB" />
                    </ComboBox>
                </StackPanel>

                <StackPanel Orientation="Vertical" Margin="4" Grid.Column="2" Grid.Row="0">
                    <TextBlock Text="Конечная валюта" Margin="0 0 0 4" />
                    <ComboBox x:Name="TargetCurrencyBox" SelectedIndex="1" Height="28" IsEnabled="False" SelectionChanged="CurrencyBox_SelectionChanged">
                        <ComboBoxItem Content="USD" Tag="USD" />
                        <ComboBoxItem Content="EUR" Tag="EUR" />
                        <ComboBoxItem Content="RUB" Tag="RUB" />
                    </ComboBox>
                </StackPanel>

                <StackPanel Orientation="Vertical" Margin="4" Grid.Column="0" Grid.Row="1">
                    <TextBlock Text="Сумма" Margin="0 0 0 4" />
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <TextBox x:Name="AmountBox" Height="28" Grid.Column="0" />
                        <Button x:Name="MaxAmountButton"
                                Grid.Column="1"
                                Content="MAX"
                                Margin="6 0 0 0"
                                Padding="10,0"
                                Visibility="Collapsed"
                                Click="MaxAmountButton_Click" />
                    </Grid>
                </StackPanel>

                <StackPanel Orientation="Vertical" Margin="4" Grid.Column="1" Grid.Row="1">
                    <TextBlock x:Name="RateLabel" Text="Курс" Margin="0 0 0 4" />
                    <TextBox x:Name="RateBox" Height="28" />
                </StackPanel>

                <StackPanel Orientation="Vertical" Margin="4" Grid.Column="2" Grid.Row="1">
                    <TextBlock Text="Комиссия (опционально)" Margin="0 0 0 4" />
                    <TextBox x:Name="FeeBox" Height="28" />
                </StackPanel>

                <StackPanel Orientation="Vertical" Margin="4" Grid.Column="0" Grid.Row="2">
                    <TextBlock Text="Дата" Margin="0 0 0 4" />
                    <DatePicker x:Name="DateBox" SelectedDate="{x:Static sys:DateTime.Today}" Height="28" />
                </StackPanel>

                <StackPanel x:Name="ExpenseCategoryPanel" Orientation="Vertical" Margin="4" Grid.Column="1" Grid.Row="2" Grid.ColumnSpan="2" Visibility="Collapsed">
                    <TextBlock Text="Категория расхода" Margin="0 0 0 4" />
                    <ComboBox x:Name="ExpenseCategoryBox" Height="28" SelectedIndex="-1">
                        <ComboBoxItem Content="Еда и продукты" />
                        <ComboBoxItem Content="Транспорт" />
                        <ComboBoxItem Content="Жильё / аренда" />
                        <ComboBoxItem Content="Коммунальные услуги" />
                        <ComboBoxItem Content="Здоровье и лекарства" />
                        <ComboBoxItem Content="Образование и саморазвитие" />
                        <ComboBoxItem Content="Развлечения и досуг" />
                        <ComboBoxItem Content="Одежда и обувь" />
                        <ComboBoxItem Content="Путешествия" />
                        <ComboBoxItem Content="Другое" />
                    </ComboBox>
                </StackPanel>

                <StackPanel x:Name="ExpenseCommentPanel" Orientation="Vertical" Margin="4" Grid.Column="0" Grid.Row="3" Grid.ColumnSpan="3" Visibility="Collapsed">
                    <TextBlock Text="Комментарий" Margin="0 0 0 4" />
                    <TextBox x:Name="ExpenseCommentBox" Height="28" />
                </StackPanel>

                <StackPanel Orientation="Horizontal" Margin="4" Grid.Column="0" Grid.Row="4" Grid.ColumnSpan="3" VerticalAlignment="Bottom" HorizontalAlignment="Left">
                    <Button Content="Добавить операцию" Click="AddOperation_Click" Height="32" Width="180" />
                </StackPanel>
            </Grid>
        </Border>

        <!-- Operations history -->
        <Grid Grid.Row="2">
            <Grid.RowDefinitions>
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <DataGrid Grid.Row="0"
                      x:Name="OperationsGrid"
                      AutoGenerateColumns="False"
                      ItemsSource="{Binding}"
                      Background="#202020"
                      Foreground="#EEEEEE"
                      RowBackground="#202020"
                      AlternatingRowBackground="#2A2A2A"
                      AlternationCount="2"
                      BorderBrush="#444444"
                      GridLinesVisibility="All"
                      HorizontalGridLinesBrush="#444444"
                      VerticalGridLinesBrush="#444444"
                      HeadersVisibility="Column"
                      CanUserAddRows="False"
                      SelectionChanged="OperationsGrid_SelectionChanged">
                <DataGrid.Resources>
                    <Style TargetType="DataGridRow">
                        <Setter Property="Foreground" Value="#EEEEEE" />
                        <Setter Property="Background" Value="{x:Null}" />
                        <Setter Property="BorderBrush" Value="#444444" />
                    </Style>
                    <Style TargetType="DataGridCell">
                        <Setter Property="Foreground" Value="#EEEEEE" />
                        <Setter Property="Background" Value="{x:Null}" />
                        <Setter Property="BorderBrush" Value="#444444" />
                        <Setter Property="BorderThickness" Value="0.5" />
                    </Style>
                    <Style TargetType="DataGridColumnHeader">
                        <Setter Property="Foreground" Value="White" />
                        <Setter Property="Background" Value="#303030" />
                        <Setter Property="BorderBrush" Value="#444444" />
                        <Setter Property="BorderThickness" Value="0,0,0,1" />
                    </Style>
                </DataGrid.Resources>
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Дата" Binding="{Binding Date, StringFormat=yyyy-MM-dd}" Width="130" />
                    <DataGridTextColumn Header="Тип" Binding="{Binding Type}" Width="120" />
                    <DataGridTextColumn Header="Из" Binding="{Binding SourceCurrency}" Width="Auto" />
                    <DataGridTextColumn Header="Сумма из" Binding="{Binding SourceAmount, StringFormat=F2}" Width="*" />
                    <DataGridTextColumn Header="В" Binding="{Binding TargetCurrency}" Width="Auto" />
                    <DataGridTextColumn Header="Сумма в" Binding="{Binding TargetAmount, StringFormat=F2}" Width="*" />
                    <DataGridTextColumn Header="Курс" Binding="{Binding Rate, StringFormat=F4}" Width="Auto" />
                    <DataGridTextColumn Header="Комиссия" Binding="{Binding Commission, StringFormat=F2}" Width="Auto" />
                    <DataGridTextColumn Header="USD экв." Binding="{Binding UsdEquivalent, StringFormat=F2}" Width="*" />
                    <DataGridTextColumn Header="Категория" Binding="{Binding ExpenseCategory}" Width="*" />
                    <DataGridTextColumn Header="Комментарий" Binding="{Binding ExpenseComment}" Width="2*" />
                </DataGrid.Columns>
            </DataGrid>

            <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0 8 0 0">
                <Button x:Name="ExportButton"
                        Content="Экспорт в XLSX"
                        Click="ExportToXlsx_Click"
                        Padding="12,6"
                        Margin="0 0 8 0" />
                <Button x:Name="ImportButton"
                        Content="Импорт из XLSX"
                        Click="ImportFromXlsx_Click"
                        Padding="12,6"
                        Margin="0 0 8 0" />
                <Button x:Name="HistoryButton"
                        Content="История изменений"
                        Click="OpenHistory_Click"
                        Padding="12,6"
                        Margin="0 0 8 0" />
                <Button x:Name="DeleteOperationButton"
                        Content="Удалить выбранную операцию"
                        Click="DeleteOperation_Click"
                        IsEnabled="False"
                        Padding="12,6" />
            </StackPanel>
        </Grid>
    </Grid>
</Window>
